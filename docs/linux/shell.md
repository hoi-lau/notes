---
title: shell入门总结
date: 2020-04-25
categories:
 - linux
tags:
 - shell
publish: false
---

## start

```bash
#! /bin/bash
## 指定脚本解释器类型 bash,php
chmod +x ./test.sh
## 使脚本具有执行权限
```

### variable

<b>变量命名规则</b>


- 命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。
- 中间不能有空格，可以使用下划线（_）。
- 不能使用标点符号。
- 不能使用bash里的关键字（可用help命令查看保留关键字）。

`eg:` `my_name`

<b>使用规则</b>

常用: ${my_name}

### 只读变量

`readonly my_name`

### 删除变量

`unset my_name`

<b>无法删除只读变量</b>

### 变量类型

运行shell时，会同时存在三种变量：

- **1) 局部变量** 局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。
- **2) 环境变量** 所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量。
- **3) shell变量** shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行

### shell字符串

### 单引号' '

单引号字符串的限制：

- 单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；
- 单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用

### 双引号" "

双引号的优点：

- 双引号里可以有变量

### 反引号``

代表系统命令,等于$()

### 获取字符串长度

```bash
echo ${#string}
```

### 提取子字符串

```bash
echo ${string:1:3}
## 从第二个字符开始截取3个字符
```

### 查找子字符串

```bash
my_name="liuk"
echo `expr index "${my_name}" iu`
## 2
```

### shell数组

只支持一维数组

```shell
my_name=(liuk liukai ll)
my_name[0]=' liukai'
echo ${my_name[0]}
# 使用@符号可以获取数组中的所有元素
echo ${my_name[@]}
# 获取数组的长度
echo ${#my_name[@]}
```



## shell基础

### shell变量

| 参数处理 | 说明                                                         |
| :------- | :----------------------------------------------------------- |
| $#       | 传递到脚本的参数个数                                         |
| $*       | 以一个单字符串显示所有向脚本传递的参数。 如"$*"用「"」括起来的情况、以"$1 $2 … $n"的形式输出所有参数。$0, 当前脚本名 |
| $$       | 脚本运行的当前进程ID号                                       |
| $!       | 后台运行的最后一个进程的ID号                                 |
| $@       | 与$*相同，但是使用时加引号，并在引号中返回每个参数。 如"$@"用「"」括起来的情况、以"$1" "$2" … "$n" 的形式输出所有参数。 |
| $-       | 显示Shell使用的当前选项，与set命令功能相同。                 |
| $?       | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。 |

### history

查看历史命令

options:

- -c 清空历史命令
- -w 将缓存中的历史命令写入文件

默认保存1000条,~/.bash_history

/etc/profile  HISTSIZE

- 使用 ` !n`执行第n条历史命令
- 使用`!!`执行上一条命令
- `!str_prefix`符合匹配的最近一条命令

### 命令执行顺序

1. 绝对路径或者相对路径执行的命令
2. 别名执行的命令
3. bash内部命令
4. 环境变量定义的命令

### Bash常用快捷键

| 快捷键   | 作用               |
| -------- | ------------------ |
| Ctrl + A | 光标移动到行首     |
| Ctrl + E | 光标移动到行尾     |
| Ctrl + C | 终止当前命令       |
| Ctrl + L | 清屏 相当于 clear  |
| Ctr + U  | 剪切光标之前的命令 |
| Ctrl + K | 剪切光标之后的命令 |
| Ctrl + R | 从历史命令中搜索   |
| Ctrl + D | 退出当前终端       |
| Ctrl + S | 暂停屏幕输出       |
| Ctrl + Q | 恢复屏幕输出       |

### 标准输入输出

| 设备   | 设备文件名  | 文件描述符 | 类型         |
| ------ | ----------- | ---------- | ------------ |
| 键盘   | /dev/stdin  | 0          | 标准输入     |
| 显示器 | /dev/sdtout | 1          | 标准输出     |
| 显示器 | /dev/sdterr | 2          | 标准错误输出 |

### 输出重定向

命令>文件

```shell
# 记录正确输出
# 记录ls内容到ls.log
ls>ls.log
# 原有文件上追加
ls>>ls.log

# 记录错误输出
# 错误输出重定向
lsll 2> lsll.log
lsll 2>> lsll.log

# 同时记录正确和错误输出
# 命令 > 文件 2>&1  覆盖
# 命令 >> 文件 2>&1 追加
ls &> ls.log

# 正确错误分开保存
# 命令>>文件1 2>>文件2
```

### 输入重定向

wc命令

```shell
# 统计文件 行数 单词数量 字符数
wc < file
```

### 多命令顺序执行

| 多命令执行符 | 格式             | 作用                               |
| ------------ | ---------------- | ---------------------------------- |
| ;            | 命令1 ; 命令2    | 多个命令顺序执行,没有逻辑联系      |
| &&           | 命令1 && 命令2   | 逻辑与,命令1错误执行,命令2不会执行 |
| \|\|         | 命令1 \|\| 命令2 | 逻辑或,命令1错误执行,命令2才会执行 |

### 管道符 | 

命令1 | 命名2

**命令1的输出作为命令2的输入,命令1必须有正确输出**

### 通配符

| 通配符 | 作用                                 |
| ------ | ------------------------------------ |
| ?      | 匹配任意一个字符                     |
| *      | 0或者多个字符                        |
| []     | eg:[abcd]匹配abcd任意一个字符. [a-z] |

### 预定义变量

| 变量 | 作用                                         |
| ---- | -------------------------------------------- |
| $?   | 最后一次执行命令的返回状态.只有0代表正确执行 |
| $$   | 当前进程id                                   |
| $!   | 后台运行的最后一个程序的pid                  |

### 接受键盘输入

read命令 

```shell
# 变量赋值
# read [options] 变量
read -s -t 30 -n 2 -p "提示信息" 变量
# -s 隐藏输入
# -t 指定等待时间, 秒数
# -n 指定输入字符数
# -p 提示信息
```

### 流程控制

### if else

```shell
if [condition]
  then
elif
  then
else
fi
```

### case

```shell
case $var in
  "1")
    echo "1"
    ;;
  "2")
    echo "2"
    ;;
  *)
    ;;
esac
```

### 循环

for

```shell
for i in 1 2 3 4
  do
    ...
  done
  
for (( i=1;i<100;i=i+1 ))
  do
  done
  
while condition
do
done
```

### 获取当前脚本绝对路径

```shell
SHELL_PATH=$(dirname $(readlink -f "$0"))
```

### echo

输出命令

-e: 支持反斜线控制的字符转换(转义字符)

| 控制字符 | 用途                 |
| -------- | -------------------- |
| \ \      | \                    |
| \a       | 输出警告音           |
| \b       | 退格                 |
| \c       | 取消输出行末的换行符 |
| \e       | ESCAPE键             |
| \f       | 换页                 |
| \n       | 换行                 |
| \r       | 回车                 |
| \t       | 制表                 |
| \v       | 垂直制表             |
| \0nnn    | ACSII码              |

### cut

字段提取命令,常用选项

-d 分割符,默认是制表符(ctrl v tab)

-f 第几列 1,3

对空格不友好

### printf

格式化输出数据

```shell
$ printf '%s %s\n' 1 2 3 4 5 6
1 2
3 4
5 6
```

### awk

常用截取指定的列

```shell
# awk '条件1{action}条件2{action}' filename
# 截取第2列,第5列 $0代表所有
awk '{printf $2 "\t" $5 "\n"}' error.log
# 如果需要加入分隔符 FS: linux分隔符
awk 'BEGIN{FS=":"}{}'
# 后置通知END
```

### sed

对数据行选取,替换,删除,新增.可以配合管道符,可以改变文件内容(-i)

<b>不加行号代表所有</b>

```shell
sed -n '2p' study.txt
# 输出第二行内容 print
sed '2a hello' study.txt
# 追加 add
sed '2i hello' study.txt
# 插入 insert

# 替换内容
# c替换整行
sed '2c hello' study.txt
# s替换字符串, 将第二行99替换成98
sed '2c/99/98/g' study.txt
# s后面表示分隔符
sed 's#./#https://imliuk.com/#'
```

### test

用于条件判断

```shell
test -e  /root/install.log
# 判断文件是否存在 [ -e /root/install.log]
```

### pushd & popd

```shell
# pushd 切换目录并将目录压进栈.
pushd /opt/data
pushd +2
# dirs -p 可以查看栈
popd
# popd 出栈并切换到栈顶目录
```

## shell 函数

### 函数定义

```bash
getName(){
  my_name="liuk"
  echo "my name is ${my_name}"
}
getName
# 函数在使用前必须定义
```

### 给函数传递参数

```bash
getName(){
  echo "my name is $1 $2"
}
getName liu kai
# 使用参数建议带{}
```

还有几个特殊字符用来处理参数：

| 参数处理 | 说明                                                         |
| :------- | :----------------------------------------------------------- |
| $#       | 传递到脚本的参数个数                                         |
| $*       | 以一个单字符串显示所有向脚本传递的参数                       |
| $$       | 脚本运行的当前进程ID号                                       |
| $!       | 后台运行的最后一个进程的ID号                                 |
| $@       | 与$*相同，但是使用时加引号，并在引号中返回每个参数。         |
| $-       | 显示Shell使用的当前选项，与set命令功能相同。                 |
| $?       | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。 |

## 运算

### declare声明变量类型

declare [+/-] [options] 变量

- +: 给变量设定类型属性

- -: 给变量取消类型属性
- -i: 整形
- -x: 环境变量
- -p: 显示变量的类型

declare -i c=$a+$b

### expr let数值运算

c=$(expr $a + $b)

+号左右必须有空格

### $(()) 或者 $[]

(())表示整数运算,加上$获取命令结果.(无法计算小数)

c=$(($a + $b))

### 变量置换表

